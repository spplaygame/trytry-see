<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æ•™è‚²æµ®èª‡å‡å®˜å¤§ä½œæˆ° â”‚ EDU Rank Rush</title>
  <style>
    body {
      font-family: "Noto Sans TC", sans-serif;
      background: #f5f7fa;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
      padding: 40px;
    }
    h1, h2, h3 {
      color: #334;
      margin: 0.4rem 0;
    }
    textarea, input {
      font-family: inherit;
      font-size: 1rem;
      width: 90%;
      max-width: 620px;
    }
    button {
      padding: 0.6rem 1.4rem;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
      margin-top: 0.6rem;
    }
    button:hover {
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }
    #rateResult {
      margin-top: 1rem;
      font-size: 1.2rem;
    }
    #firework {
      font-size: 3rem;
      line-height: 1.2;
      display: none;
      margin-top: 0.4rem;
    }
  </style>
</head>
<body>

<h1>æ•™è‚²æµ®èª‡å‡å®˜å¤§ä½œæˆ°</h1>
<p>å¯«ä¸‹ä¸€å¥æ•™è‚²å£è™Ÿï¼Œçœ‹çœ‹ä½ èƒ½ä¸èƒ½ä¸€æ­¥å°ç¥ï¼</p>

<label>ç©å®¶åç¨±ï¼š
  <input id="playerName" placeholder="æš±ç¨±ï¼ˆé è¨­åŒ¿åç²‰ç­†ä¿ ï¼‰">
</label><br>

<textarea id="userIdea" rows="4" placeholder="æŠŠä½ çš„æ•™è‚²ç†å¿µè²¼åœ¨é€™è£¡"></textarea><br>
<button onclick="rateIdea()">è©•é‘‘ï¼</button>

<div id="rateResult"></div>
<div id="firework">ğŸ†ğŸ‡ğŸ†</div>

<h3>ğŸ† æ’è¡Œæ¦œï¼ˆæ‰€æœ‰ç©å®¶ï¼‰</h3>
<ol id="leaderboard"></ol>

<script>
const ENDPOINT = 'https://script.google.com/macros/s/AKfycbxqXVMMBu2XokbXAlrQgk9OE5qYag-W7YAO-ZlRMc2kQmzM8eznRsg84XLcfT2d6tj2/exec';

const buzzWords = ["æœªä¾†é‡å­ç´š","å…¨åŸŸç„¡ç¸«","è¶…ç¶­åº¦","å®‡å®™ç´š","è·¨æ˜Ÿç³»","å…ƒå®‡å®™",
"é ‚è¦æ——è‰¦","ğ“†ç´šï¼ˆçœ‹ä¸æ‡‚ä½†å¥½åƒå²å®³ï¼‰","AI é©…å‹•","å€å¡ŠéˆåŒ–","å››å€é€Ÿ",
"å­¸ç¿’ç”Ÿæ…‹ç³»","äººæ‰ç…‰é‡‘è¡“","æ™ºæ…§é›²ç«¯æ ¡åœ’","çœŸÂ·å…¨äººç™¼å±•çŸ©é™£",
"ç´ é¤Šå…ƒä»¶åº«","è·¨åŸŸå…±æ¦®å¯¦é©—å ´","æ½›èƒ½åŠ é€Ÿå™¨","æ•™è‚²é»‘ç§‘æŠ€",
"å…±æŒ¯å¢å¹…","éˆçµå‡é »","è¶…é »ç–ŠåŠ ","åŸå­ç´šé›•å¡‘","æ·±åº¦è³¦éˆ",
"è£‚è®Šå¼æ“´æ•£","ç²¾æº–å°å…¥","é«˜ç¶­å°è£","é›²ç«¯è½‰å°","é‡åŒ–äº®åŒ–"];

const officeLevel = [
  { title: "ç²‰ç­†è¦‹ç¿’ç…‰é‡‘å­¸å¾’", threshold: 0 },
  { title: "èª²å ‚ç¶­åº¦å¾®èª¿å·¥ç¨‹å¸«", threshold: 50 },
  { title: "ç´ é¤Šè£‚è®Šç‰¹æ”»éšŠé•·", threshold: 90 },
  { title: "æ ¡åœ’é‡å­å…±æŒ¯ç­–å±•å®˜", threshold: 130 },
  { title: "è·¨åŸŸè¶…é »é ˜èˆªå¸ä»¤", threshold: 170 },
  { title: "å…¨æ¯æ•™è‚²é¦–å¸­ç…‰ä¸¹å¸«", threshold: 210 },
  { title: "æ˜Ÿéš›å­¸ç¿’è‰¦éšŠå¸ä»¤å®˜", threshold: 250 },
  { title: "è¶…ç¶­åº¦çµ‚æ¥µæ•™è‚²å¤©å°Š", threshold: 300 }
];

const commentBank = {
  poor: [
    "é€™å¥ç†å¿µä¹¾åˆ°æ‰æ¸£ï¼Œå­¸ç”Ÿå¯èƒ½å…ˆç¡ä¸€è¼ªã€‚",
    "å¯«å¾—è·Ÿä¾¿æ¢ç´™å·®ä¸å¤šé•·ï¼Œå†ç”¨åŠ›é»å§ï¼",
    "è€å¸«çœ‹åˆ°æœƒæ‡·ç–‘ä½ æŒ‰éŒ¯è²¼ä¸Šéµã€‚"
  ],
  ok: [
    "æœ‰é»æ–™ï¼Œä½†é‚„ä¸å¤ è®“æ ¡é•·ç«™èµ·ä¾†é¼“æŒã€‚",
    "æ–¹å‘å°äº†ï¼Œå°±æ˜¯ç«åŠ›å¼±äº†äº›ã€‚",
    "å†ç‘ä¸€æŠŠé—œéµå­—èƒ¡æ¤’ç²‰æœƒæ›´é¦™ã€‚"
  ],
  good: [
    "å“¦å–”ï½é€™æ°£å‹¢ï¼Œä¸»ä»»è¾¦å…¬å®¤çš„æ¤…å­å·²ç‚ºä½ æš–å¥½ï¼",
    "å·²é”æ ¡é•·æ¼”è¬›å¼•ç”¨ç­‰ç´šï¼Œå†å¤šå…©å¥å¯ç©©å‡ç½²é•·ã€‚",
    "å­¸ç”Ÿè½ä¸æ‡‚æ²’é—œä¿‚ï¼Œæ„Ÿå—åˆ°å®‡å®™æ´ªè’çš„éœ‡å‹•å°±å¤ ã€‚"
  ],
  god: [
    "æµ®èª‡å¦‚æ–¯ï¼éƒ¨é•·çœ‹åˆ°éƒ½è¦æŠ„é€²ç™½çš®æ›¸ï¼",
    "å®‡å®™çµ‚æ–¼è¿ä¾†æ•™è‚² singularityï¼Œå¾è¼©å”¯æœ‰ä»°æœ›ã€‚",
    "é€™æ³¢æ“ä½œç›´æ¥æŠŠé»‘æ´ç…§äº®ï¼Œç„¡å¯æŒ‘å‰”ï¼"
  ]
};

function buzzCount(str) {
  let n = 0;
  buzzWords.forEach(w => {
    const re = new RegExp(w.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), "gi");
    const m = str.match(re);
    if (m) n += m.length;
  });
  return n;
}

function fireworks(ms = 2000) {
  const fw = document.getElementById("firework");
  fw.style.display = "block";
  setTimeout(() => fw.style.display = "none", ms);
}

function rateIdea() {
  const txt = document.getElementById("userIdea").value.trim();
  const name = (document.getElementById("playerName").value.trim() || "åŒ¿åç²‰ç­†ä¿ ").slice(0, 12);
  if (!txt) { alert("å…ˆè¼¸å…¥ä¸€å¥ç†å¿µå§ï¼"); return; }

  const score = Math.round(Math.min(txt.length * 0.5, 60) + buzzCount(txt) * 12 + Math.random() * 20);
  let level = officeLevel[0].title;
  for (let i = officeLevel.length - 1; i >= 0; i--)
    if (score >= officeLevel[i].threshold) { level = officeLevel[i].title; break; }

  let pool;
  if (score < 90) pool = commentBank.poor;
  else if (score < 170) pool = commentBank.ok;
  else if (score < 250) pool = commentBank.good;
  else pool = commentBank.god;

  const roast = pool[Math.floor(Math.random() * pool.length)];
  if (level === officeLevel.at(-1).title) fireworks();

  document.getElementById("rateResult").innerHTML =
    `âœ¨ <strong>${level}</strong>ï¼ˆ${score} åˆ†ï¼‰<br>${roast}`;

  fetch(ENDPOINT, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ name, score, idea: txt })
  }).then(() => renderBoard());
}

function renderBoard() {
  fetch(ENDPOINT)
    .then(r => r.json())
    .then(rows => {
      rows.sort((a, b) => b[1] - a[1]); // åˆ†æ•¸é«˜åˆ°ä½æ’åº
      const ol = document.getElementById('leaderboard');
      ol.innerHTML = '';
      rows.forEach(r => {
        const snip = (r[2] || "").slice(0, 40) + (r[2]?.length > 40 ? "â€¦" : "");
        const li = document.createElement('li');
        li.innerHTML = `<strong>${r[0]}</strong> â€” ${r[1]} åˆ†<br><small>${snip}</small>`;
        ol.appendChild(li);
      });
    });
}

renderBoard(); // è¼‰å…¥é é¢æ™‚åŸ·è¡Œ
</script>
</body>
</html>

