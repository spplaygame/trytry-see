<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>教育浮誇升官大作戰 │ EDU Rank Rush</title>
  <style>
    body {
      font-family: "Noto Sans TC", sans-serif;
      background: #f5f7fa;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
      padding: 40px;
    }
    h1, h2, h3 {
      color: #334;
      margin: 0.4rem 0;
    }
    textarea, input {
      font-family: inherit;
      font-size: 1rem;
      width: 90%;
      max-width: 620px;
    }
    button {
      padding: 0.6rem 1.4rem;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
      margin-top: 0.6rem;
    }
    button:hover {
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }
    #rateResult {
      margin-top: 1rem;
      font-size: 1.2rem;
    }
    #firework {
      font-size: 3rem;
      line-height: 1.2;
      display: none;
      margin-top: 0.4rem;
    }
  </style>
</head>
<body>

<h1>教育浮誇升官大作戰</h1>
<p>寫下一句教育口號，看看你能不能一步封神！</p>

<label>玩家名稱：
  <input id="playerName" placeholder="暱稱（預設匿名粉筆俠）">
</label><br>

<textarea id="userIdea" rows="4" placeholder="把你的教育理念貼在這裡"></textarea><br>
<button onclick="rateIdea()">評鑑！</button>

<div id="rateResult"></div>
<div id="firework">🎆🎇🎆</div>

<h3>🏆 排行榜（所有玩家）</h3>
<ol id="leaderboard"></ol>

<script>
const ENDPOINT = 'https://script.google.com/macros/s/AKfycbxqXVMMBu2XokbXAlrQgk9OE5qYag-W7YAO-ZlRMc2kQmzM8eznRsg84XLcfT2d6tj2/exec';

const buzzWords = ["未來量子級","全域無縫","超維度","宇宙級","跨星系","元宇宙",
"頂規旗艦","𓆏級（看不懂但好像厲害）","AI 驅動","區塊鏈化","四倍速",
"學習生態系","人才煉金術","智慧雲端校園","真·全人發展矩陣",
"素養元件庫","跨域共榮實驗場","潛能加速器","教育黑科技",
"共振增幅","鏈結升頻","超頻疊加","原子級雕塑","深度賦靈",
"裂變式擴散","精準導入","高維封裝","雲端轉印","量化亮化"];

const officeLevel = [
  { title: "粉筆見習煉金學徒", threshold: 0 },
  { title: "課堂維度微調工程師", threshold: 50 },
  { title: "素養裂變特攻隊長", threshold: 90 },
  { title: "校園量子共振策展官", threshold: 130 },
  { title: "跨域超頻領航司令", threshold: 170 },
  { title: "全息教育首席煉丹師", threshold: 210 },
  { title: "星際學習艦隊司令官", threshold: 250 },
  { title: "超維度終極教育天尊", threshold: 300 }
];

const commentBank = {
  poor: [
    "這句理念乾到掉渣，學生可能先睡一輪。",
    "寫得跟便條紙差不多長，再用力點吧！",
    "老師看到會懷疑你按錯貼上鍵。"
  ],
  ok: [
    "有點料，但還不夠讓校長站起來鼓掌。",
    "方向對了，就是火力弱了些。",
    "再灑一把關鍵字胡椒粉會更香。"
  ],
  good: [
    "哦喔～這氣勢，主任辦公室的椅子已為你暖好！",
    "已達校長演講引用等級，再多兩句可穩升署長。",
    "學生聽不懂沒關係，感受到宇宙洪荒的震動就夠。"
  ],
  god: [
    "浮誇如斯！部長看到都要抄進白皮書！",
    "宇宙終於迎來教育 singularity，吾輩唯有仰望。",
    "這波操作直接把黑洞照亮，無可挑剔！"
  ]
};

function buzzCount(str) {
  let n = 0;
  buzzWords.forEach(w => {
    const re = new RegExp(w.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), "gi");
    const m = str.match(re);
    if (m) n += m.length;
  });
  return n;
}

function fireworks(ms = 2000) {
  const fw = document.getElementById("firework");
  fw.style.display = "block";
  setTimeout(() => fw.style.display = "none", ms);
}

function rateIdea() {
  const txt = document.getElementById("userIdea").value.trim();
  const name = (document.getElementById("playerName").value.trim() || "匿名粉筆俠").slice(0, 12);
  if (!txt) { alert("先輸入一句理念吧！"); return; }

  const score = Math.round(Math.min(txt.length * 0.5, 60) + buzzCount(txt) * 12 + Math.random() * 20);
  let level = officeLevel[0].title;
  for (let i = officeLevel.length - 1; i >= 0; i--)
    if (score >= officeLevel[i].threshold) { level = officeLevel[i].title; break; }

  let pool;
  if (score < 90) pool = commentBank.poor;
  else if (score < 170) pool = commentBank.ok;
  else if (score < 250) pool = commentBank.good;
  else pool = commentBank.god;

  const roast = pool[Math.floor(Math.random() * pool.length)];
  if (level === officeLevel.at(-1).title) fireworks();

  document.getElementById("rateResult").innerHTML =
    `✨ <strong>${level}</strong>（${score} 分）<br>${roast}`;

  fetch(ENDPOINT, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ name, score, idea: txt })
  }).then(() => renderBoard());
}

function renderBoard() {
  fetch(ENDPOINT)
    .then(r => r.json())
    .then(rows => {
      rows.sort((a, b) => b[1] - a[1]); // 分數高到低排序
      const ol = document.getElementById('leaderboard');
      ol.innerHTML = '';
      rows.forEach(r => {
        const snip = (r[2] || "").slice(0, 40) + (r[2]?.length > 40 ? "…" : "");
        const li = document.createElement('li');
        li.innerHTML = `<strong>${r[0]}</strong> — ${r[1]} 分<br><small>${snip}</small>`;
        ol.appendChild(li);
      });
    });
}

renderBoard(); // 載入頁面時執行
</script>
</body>
</html>

